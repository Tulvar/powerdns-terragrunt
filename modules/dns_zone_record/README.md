# Описание работы модуля

1. Очищенные DNS-записи (cleaned_dns_records):
- Создает карту DNS-записей из var.dns_records_map.
- Итерируется по каждой зоне (zone) и соответствующим записям (records).
- Для каждой записи, итерируется по ее типу (type) и значению (value), включая пару только если value не равно null.

2. Очищенные Дополнительные Записи (cleaned_additional_records):
- Аналогично cleaned_dns_records, но работает с другим источником данных var.additional_records.
- Итерируется по зонам и записям, исключая записи с null значениями.

3. Объединенные Записи (combined_records):
- Объединяет cleaned_dns_records и cleaned_additional_records в одну структуру.
- Получает уникальные зоны, комбинируя ключи из обоих наборов данных.
- Для каждой зоны, получает уникальные типы записей, комбинируя ключи из обоих наборов для данной зоны.
- Объединяет записи из обоих наборов данных для каждого типа, используя имя записи (r.name) в качестве ключа.

4. Плоские Записи (flat_records):
- Преобразует combined_records в плоскую структуру, подходящую для итерации в ресурсах.
- Итерируется по каждой зоне и ее типам записей.
- Для каждой записи создает словарь с атрибутами: уникальный идентификатор (id), зону (zone), имя (name), тип (type), значения (values) и время жизни (ttl).
- Если ttl не указан, используется значение по умолчанию (3600 секунд).

5. Настройка Провайдера PowerDNS:
- Настраивает провайдера PowerDNS с API-ключом и URL-адресом сервера из переменных.

6. Ресурс Зоны PowerDNS (powerdns_zone):
- Определяет DNS-зоны из ключей в var.dns_records_map.
- Устанавливает имена зон и настраивает набор серверов имен для каждой зоны.

7. Ресурс Записи PowerDNS (powerdns_record):
- Создает DNS-записи на основе данных в local.flat_records.
- Использует for_each для итерации по каждой записи в flat_records.
- Устанавливает зону, имя, тип, ttl и значения записей для каждой DNS-записи.
- Устанавливает зависимость от powerdns_zone.zones, чтобы гарантировать создание зон перед записями.
